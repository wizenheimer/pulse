# Version : 3.0
# =================================================================
# Changelog :
# Replaced Recipients with Entity
# Added Type to assist in Parsing Entitites
# Added Support for User Groups
# Simplified System to Alert
# Defined Type with Email, User Groups, Hooks, Slack, Team
policy:
  name: My Escalation Policy
  # A custom yaml policy for creating escalation policies
  delay: 10
  # denotes delay in seconds between every level of the policy
  repeat: 0
  # denotes number of times the policy would be repeated
  urgency: 5
  # denotes the urgency of the incident
  impact: 5
  # denotes the impact of the incident
  # priority = urgency[0.6] * impact[0.4]
  levels:
    # level 0 is reserved for on-call responders
    - name: Level 1
      # denotes the level, should be a positive integral value
      delay: 10
      # denotes the delay in seconds between successive actions
      repeat: 0
      # denotes policy repeatition
      urgency: 5
      # modify the urgency level of the incident
      day: 1,2,3,4,5,6,7
      # denotes the day of the week for the level to be triggered, defaults to all using 0
      start_time: 1000
      # defaults to 24x7
      end_time: 1400
      # defaults to 24x7
      timezone: UTC
      # defaults to UTC 
      actions:
        - name: Notify Customer Success Teams
          intent: Alert
          # Entity doesn't have option to acknowledge the event
          context: Incident {incident.id} requires attention
          entity: support@example.com
          # can be `entire_team`
          type: Email
          # in case of 'entire_team' type should be attribute
        - name: Notify Backend Teams
          intent: Resolve
          context: Incident {incident.id} requires attention
          entity: +1234567890
          type: Phone
        - name: Create ticket
          intent: Resolve
          entity: Development
          # name of the channel, incase not present would post message to general incident channel
          type: Slack
          # in case of person, could be user_id
          context: Incident {incident.id} requires attention

    - name: Level 2
      delay: 10
      # denotes the delay in seconds between successive actions
      actions:
        - name: Create ticket
          intent: Notify
          context: Please investigate the incident and provide an update
          # creates an issue using a middleware, webhook->middleware->JIRA Ticket
          type: JIRA
          # entity and type would be ignored
        - name: Create ticket
          intent: Resolve
          entity: Development
          # name of the channel, incase not present would post message to general incident channel
          type: Slack
          # in case of person, could be user_id
          context: Incident {incident.id} requires attention
        - name: Send email
          system: Notify
          entity: manager@example.com, manager2@example.com,  manager3@example.com
          type: CSEmail
          # email address comma separated
        - name: Send email
          system: Notify
          entity: 1
          # notify the member using the member id, notify touches every possible touchpoint
          # alternative is 'entire_team'
        - name: Send SMS
          system: Webhook
          entity: https://example.com/webhook
          # webhook to trigger during an incident
          context: Please investigate the incident and provide an update
          # context can be empty
          type: url
          # parse the entity as a url
        - name: Create ticket
          system: JIRA
          summary: Incident {{incident.id}} still requires attention
          description: Please escalate this issue to the next level of support

    - name: Level 3
      actions:
        - name: Send email
          # when system is not specified it throws a validation error
          entity: director@example.com
        - name: Send SMS
          # when system is not specified it throws a validation error
          entity: +1234567890
        - name: Create ticket
          system: JIRA
          summary: Incident {{incident.id}} has not been resolved
          description: Please provide an urgent update on the status of this incident

    - name: Level 4
      # autogenerated
      # denotes whether team would be notified of the incident
      actions:
        - name: Notify Team
          intent: Resolve
          context: Incident {{incident.id}} requires attention.
          entity: Team
          type: Attribute
